{% extends 'base.html' %}
{% load django_bootstrap5%}
{% block body %}

<div class="container d-flex flex-column">
  <h1>디테일 페이지</h1>
  <!-- 내용 -->
  <p>{{ photospot.user.username }}</p>
  <img width="500;" src="{{ photospot.photo_img.url }}" alt="{{ photospot.photo_img }}">
  <p>{{ photospot.content }}</p>
  <!-- 좋아요 -->
  <div class="d-flex align-items-center">
    {% if request.user.is_authenticated %}
      {% if request.user in photospot.like_users.all %}
        <i id="like-btn" data-photospot-id="{{ photospot.pk }}" class="bi bi-heart-fill" style="color:red; cursor: pointer;"></i>
      {% else %}
        <i id="like-btn" data-photospot-id="{{ photospot.pk }}" class="bi bi-heart" style="color:red; cursor: pointer;"></i>
      {% endif %}
      <span id="like-count" > {{ photospot.like_users.count }}</span>
    {% else %}
      <i class="bi bi-heart-fill" style="color:red;"></i>
      <span id="like-count" > {{ photospot.like_users.count }}</span>
    {% endif %}
  </div>
  <!-- 수정/삭제 -->
  <a href="{% url 'photospots:update' photospot.pk %}">update</a>
  <a href="{% url 'photospots:delete' photospot.pk %}">delete</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  const likeBtn = document.querySelector('#like-btn')
  likeBtn.addEventListener('click', function (event) {
    console.log(event.target)
    axios({
      method: 'get',
      url: `/photospots/${event.target.dataset.photospotId}/like`
    })
    .then(response => {
      console.log(response)
      console.log(response.data)
      if (response.data.isLiked === true) {
        event.target.classList.add('bi-heart-fill')
        event.target.classList.remove('bi-heart')
      }
      else {
        event.target.classList.add('bi-heart')
        event.target.classList.remove('bi-heart-fill')
      }
      const likeCount = document.querySelector('#like-count')
      likeCount.innerText = response.data.likeCount
    })
  })
</script>

{% endblock body %}