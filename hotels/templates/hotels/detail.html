{% extends 'base.html' %}
{% load humanize %}
{% block body %}
<div class="container">
  <div class="d-flex justify-content-center gap-1 my-3">
    <img src="{{ hotel.image }}" class="col-12 col-sm-6 img-fluid rounded" alt="{{ hotel.name }}">
    <div class="col-12 col-sm-6">
      <div id="map" class="rounded w-100 h-100"></div>
      <p id="hotel-address" class="d-none">{{ hotel.address }}</p>
    </div>
  </div>
  <div class="ms-1">
    <h3 id="hotel-name" class="fw-bold">{{ hotel.name }}</h3>
  </div>
  <div class="d-flex justify-content-between ms-1">
    <div>
      <i class="bi bi-star-fill text-danger"></i>
      <b>{{ hotel.user_rating }}</b>
    </div>
    <div>
      <span class="text-muted">1박(세금 미포함)</span>
      <b class="text-danger fw-bold fs-3">{{ hotel.price | intcomma }}원</b>
    </div>
  </div>
  <div>
    <h3>리뷰 목록</h3>
    <a href="{% url 'hotels:review_create' hotel.pk %}">리뷰 쓰기</a>
  </div>
</div>


<!-- kakao map -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=de7c022be837f13274b4aba3349121c7&libraries=services"></script>
<script>
  var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
  mapOption = {
    center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
    level: 3 // 지도의 확대 레벨
  };  

  // 지도를 생성합니다    
  var map = new kakao.maps.Map(mapContainer, mapOption); 

  // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
  var mapTypeControl = new kakao.maps.MapTypeControl();

  // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
  // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
  map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

  // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
  var zoomControl = new kakao.maps.ZoomControl();
  map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

  // 주소-좌표 변환 객체를 생성합니다
  var geocoder = new kakao.maps.services.Geocoder();

  // 주소로 좌표를 검색합니다
  const hotelAddress = document.querySelector('#hotel-address').innerText
  geocoder.addressSearch(hotelAddress, function(result, status) {

    // 정상적으로 검색이 완료됐으면 
    if (status === kakao.maps.services.Status.OK) {

      var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

      // 결과값으로 받은 위치를 마커로 표시합니다
      var marker = new kakao.maps.Marker({
        map: map,
        position: coords
      });

      // 인포윈도우로 장소에 대한 설명을 표시합니다
      const hotelName = document.querySelector('#hotel-name').innerText
      var infowindow = new kakao.maps.InfoWindow({
        content: '<div style="width:200px;text-align:center;padding:6px 0;"><p>' + hotelName + '</p><a href="https://map.kakao.com/link/map/' + hotelName + ',' + result[0].y + ',' + result[0].x + '" style="color:blue" target="_blank">큰 지도 보기</a> <a href="https://map.kakao.com/link/to/' + hotelName + ',' + result[0].y + ',' + result[0].x + '" style="color:blue" target="_blank">길찾기</a></div>'
      });
      infowindow.open(map, marker);

      // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
      map.setCenter(coords);
    } 
  }); 
</script>

{% endblock body %}